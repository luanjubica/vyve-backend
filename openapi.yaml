openapi: 3.0.3
info:
  title: Vyve API
  version: 1.0.0
  description: >
    Vyve Backend API for authentication, users, people/relationships, interactions, reflections, nudges, analytics, and GDPR operations.
    Note: Person uses normalized dictionary IDs (category_id, communication_method_id, relationship_status_id, intention_id).
servers:
  - url: http://localhost:8080/api/v1
    description: Local Dev

tags:
  - name: Auth
  - name: Users
  - name: People
  - name: Interactions
  - name: Reflections
  - name: Nudges
  - name: GDPR
  - name: Search
  - name: Analytics
  - name: Admin
  - name: System
  - name: Dictionaries

security:
  - bearerAuth: []

paths:
  /auth/login:
    post:
      tags: [Auth]
      summary: Login with email/username and password
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        '200':
          description: JWT tokens
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }
        '401': { $ref: '#/components/responses/Unauthorized' }

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RefreshRequest' }
      responses:
        '200':
          description: New access token
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }
        '401': { $ref: '#/components/responses/Unauthorized' }

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout / revoke refresh token
      responses:
        '204': { description: Logged out }

  /auth/forgot-password:
    post:
      tags: [Auth]
      summary: Request password reset
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string, format: email }
              required: [email]
      responses:
        '200':
          description: Reset email sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /auth/reset-password:
    post:
      tags: [Auth]
      summary: Reset password with token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token: { type: string }
                new_password: { type: string, format: password }
              required: [token, new_password]
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /auth/verify-email/{token}:
    get:
      tags: [Auth]
      summary: Verify email address
      security: []
      parameters:
        - name: token
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Email verified
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /auth/google:
    get:
      tags: [Auth]
      summary: Initiate Google OAuth flow
      security: []
      responses:
        '302':
          description: Redirect to Google OAuth

  /auth/google/callback:
    get:
      tags: [Auth]
      summary: Google OAuth callback
      security: []
      parameters:
        - name: code
          in: query
          schema: { type: string }
        - name: state
          in: query
          schema: { type: string }
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }

  /auth/linkedin:
    get:
      tags: [Auth]
      summary: Initiate LinkedIn OAuth flow
      security: []
      responses:
        '302':
          description: Redirect to LinkedIn OAuth

  /auth/linkedin/callback:
    get:
      tags: [Auth]
      summary: LinkedIn OAuth callback
      security: []
      parameters:
        - name: code
          in: query
          schema: { type: string }
        - name: state
          in: query
          schema: { type: string }
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }

  /auth/apple:
    get:
      tags: [Auth]
      summary: Initiate Apple OAuth flow
      security: []
      responses:
        '302':
          description: Redirect to Apple OAuth

  /auth/apple/callback:
    post:
      tags: [Auth]
      summary: Apple OAuth callback
      security: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                code: { type: string }
                state: { type: string }
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }

  /users/me:
    get:
      tags: [Users]
      summary: Get current user profile
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema: { $ref: '#/components/schemas/User' }
    put:
      tags: [Users]
      summary: Update current user profile
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateUserRequest' }
      responses:
        '200':
          description: Updated profile
          content:
            application/json:
              schema: { $ref: '#/components/schemas/User' }
    delete:
      tags: [Users]
      summary: Delete user account
      responses:
        '204':
          description: Account deleted
        '401': { $ref: '#/components/responses/Unauthorized' }

  /users/me/upload-avatar:
    post:
      tags: [Users]
      summary: Upload avatar
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file: { type: string, format: binary }
      responses:
        '200':
          description: Updated profile
          content:
            application/json:
              schema: { $ref: '#/components/schemas/User' }

  /users/me/settings:
    get:
      tags: [Users]
      summary: Get settings
      responses:
        '200':
          description: Settings JSON
          content:
            application/json:
              schema: { type: object, additionalProperties: true }
    put:
      tags: [Users]
      summary: Update settings
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object, additionalProperties: true }
      responses:
        '200':
          description: Updated settings
          content:
            application/json:
              schema: { type: object, additionalProperties: true }

  /users/me/stats:
    get:
      tags: [Users]
      summary: Get user stats
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /users/me/change-password:
    post:
      tags: [Users]
      summary: Change password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                old_password: { type: string }
                new_password: { type: string }
              required: [old_password, new_password]
      responses:
        '501':
          description: Not implemented

  /people:
    get:
      tags: [People]
      summary: List people
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
        - name: search
          in: query
          schema: { type: string }
        - name: category_id
          in: query
          schema: { type: string, format: uuid }
        - name: order_by
          in: query
          schema: { type: string, example: name }
      responses:
        '200':
          description: People list
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PaginatedPeople' }
    post:
      tags: [People]
      summary: Create person
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreatePersonRequest' }
      responses:
        '201':
          description: Created person
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Person' }

  /people/search:
    post:
      tags: [People, Search]
      summary: Search people by name
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query: { type: string }
              required: [query]
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Person' }

  /dictionaries/categories:
    get:
      tags: [Dictionaries]
      summary: List categories for current user
      responses:
        '200':
          description: Categories
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Category' }

  /dictionaries/communication-methods:
    get:
      tags: [Dictionaries]
      summary: List communication methods
      responses:
        '200':
          description: Communication methods
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/CommunicationMethod' }

  /dictionaries/relationship-statuses:
    get:
      tags: [Dictionaries]
      summary: List relationship statuses
      responses:
        '200':
          description: Relationship statuses
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/RelationshipStatus' }

  /dictionaries/intentions:
    get:
      tags: [Dictionaries]
      summary: List intentions
      responses:
        '200':
          description: Intentions
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Intention' }

  /dictionaries/energy-patterns:
    get:
      tags: [Dictionaries]
      summary: List energy patterns
      responses:
        '200':
          description: Energy patterns
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/EnergyPattern' }

  /people/categories:
    get:
      tags: [People]
      summary: List available category names for user
      responses:
        '200':
          description: Category names
          content:
            application/json:
              schema:
                type: array
                items: { type: string }

  /people/{id}:
    get:
      tags: [People]
      summary: Get person by ID
      parameters:
        - $ref: '#/components/parameters/personId'
      responses:
        '200':
          description: Person
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Person' }
        '404': { $ref: '#/components/responses/NotFound' }
    put:
      tags: [People]
      summary: Update person
      parameters:
        - $ref: '#/components/parameters/personId'
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdatePersonRequest' }
      responses:
        '200':
          description: Updated person
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Person' }
    delete:
      tags: [People]
      summary: Delete person
      parameters:
        - $ref: '#/components/parameters/personId'
      responses:
        '204': { description: Deleted }

  /people/{id}/restore:
    post:
      tags: [People]
      summary: Restore deleted person
      parameters:
        - $ref: '#/components/parameters/personId'
      responses:
        '200':
          description: Person restored
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Person' }

  /people/{id}/interactions:
    get:
      tags: [People]
      summary: Get person's interactions
      parameters:
        - $ref: '#/components/parameters/personId'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: Person interactions
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PaginatedInteractions' }

  /people/{id}/health:
    get:
      tags: [People, Analytics]
      summary: Get person's health score
      parameters:
        - $ref: '#/components/parameters/personId'
      responses:
        '200':
          description: Health score
          content:
            application/json:
              schema:
                type: object
                properties:
                  health_score: { type: number, format: float }
                  factors:
                    type: object
                    additionalProperties: true

  /people/{id}/reminder:
    put:
      tags: [People]
      summary: Update person's reminder settings
      parameters:
        - $ref: '#/components/parameters/personId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reminder_frequency: { type: string }
                next_reminder_at: { $ref: '#/components/schemas/Timestamp' }
      responses:
        '200':
          description: Reminder updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Person' }

  /people/{id}/analysis:
    get:
      tags: [People, Analytics]
      summary: Get AI analysis for person
      parameters:
        - $ref: '#/components/parameters/personId'
      responses:
        '200':
          description: Person analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  insights: { type: array, items: { type: string } }
                  recommendations: { type: array, items: { type: string } }
                  health_score: { type: number }
                  sentiment: { type: string }
                  generated_at: { $ref: '#/components/schemas/Timestamp' }

  /people/{id}/analysis/refresh:
    post:
      tags: [People, Analytics]
      summary: Refresh AI analysis for person
      parameters:
        - $ref: '#/components/parameters/personId'
      responses:
        '202':
          description: Analysis refresh queued
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id: { type: string }
                  status: { type: string }

  /people/{id}/analysis/history:
    get:
      tags: [People, Analytics]
      summary: Get analysis history for person
      parameters:
        - $ref: '#/components/parameters/personId'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: Analysis history
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: string }
                    insights: { type: array, items: { type: string } }
                    generated_at: { $ref: '#/components/schemas/Timestamp' }

  /people/{id}/recommendations:
    get:
      tags: [People, Analytics]
      summary: Get AI recommendations for person
      parameters:
        - $ref: '#/components/parameters/personId'
      responses:
        '200':
          description: Recommendations
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: string }
                    type: { type: string }
                    title: { type: string }
                    description: { type: string }
                    priority: { type: string }
                    status: { type: string }

  /interactions:
    get:
      tags: [Interactions]
      summary: List interactions
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
        - name: person_id
          in: query
          schema: { type: string, format: uuid }
        - name: start_date
          in: query
          schema: { type: string, format: date-time }
        - name: end_date
          in: query
          schema: { type: string, format: date-time }
      responses:
        '200':
          description: Interactions list
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PaginatedInteractions' }
    post:
      tags: [Interactions]
      summary: Create interaction
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreateInteractionRequest' }
      responses:
        '201':
          description: Created interaction
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Interaction' }

  /interactions/{id}:
    get:
      tags: [Interactions]
      summary: Get interaction
      parameters: [ { $ref: '#/components/parameters/interactionId' } ]
      responses:
        '200':
          description: Interaction
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Interaction' }
        '404': { $ref: '#/components/responses/NotFound' }
    put:
      tags: [Interactions]
      summary: Update interaction
      parameters: [ { $ref: '#/components/parameters/interactionId' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateInteractionRequest' }
      responses:
        '200':
          description: Updated interaction
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Interaction' }
    delete:
      tags: [Interactions]
      summary: Delete interaction
      parameters: [ { $ref: '#/components/parameters/interactionId' } ]
      responses:
        '204': { description: Deleted }

  /interactions/recent:
    get:
      tags: [Interactions]
      summary: Get recent interactions
      parameters:
        - name: limit
          in: query
          schema: { type: integer, minimum: 1, maximum: 100, default: 10 }
      responses:
        '200':
          description: Recent interactions
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Interaction' }

  /interactions/by-date:
    get:
      tags: [Interactions]
      summary: Get interactions by date
      parameters:
        - name: date
          in: query
          required: true
          schema: { type: string, format: date }
        - name: person_id
          in: query
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Interactions for date
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Interaction' }

  /interactions/energy-distribution:
    get:
      tags: [Interactions, Analytics]
      summary: Get energy distribution for a period
      parameters:
        - name: start_date
          in: query
          schema: { type: string, format: date-time }
        - name: end_date
          in: query
          schema: { type: string, format: date-time }
      responses:
        '200':
          description: Distribution
          content:
            application/json:
              schema:
                type: object
                properties:
                  energizing: { type: integer }
                  neutral: { type: integer }
                  draining: { type: integer }

  /interactions/bulk:
    post:
      tags: [Interactions]
      summary: Bulk create interactions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              items: { $ref: '#/components/schemas/CreateInteractionRequest' }
      responses:
        '201':
          description: Created interactions
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Interaction' }

  /reflections:
    get:
      tags: [Reflections]
      summary: List reflections
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: Reflections
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PaginatedReflections' }
    post:
      tags: [Reflections]
      summary: Create reflection
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreateReflectionRequest' }
      responses:
        '201':
          description: Created reflection
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Reflection' }

  /reflections/{id}:
    get:
      tags: [Reflections]
      summary: Get reflection
      parameters: [ { $ref: '#/components/parameters/reflectionId' } ]
      responses:
        '200':
          description: Reflection
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Reflection' }
        '404': { $ref: '#/components/responses/NotFound' }
    put:
      tags: [Reflections]
      summary: Update reflection
      parameters: [ { $ref: '#/components/parameters/reflectionId' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateReflectionRequest' }
      responses:
        '200':
          description: Updated reflection
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Reflection' }
    delete:
      tags: [Reflections]
      summary: Delete reflection
      parameters: [ { $ref: '#/components/parameters/reflectionId' } ]
      responses:
        '204': { description: Deleted }

  /reflections/today:
    get:
      tags: [Reflections]
      summary: Get today's reflection (if any)
      responses:
        '200':
          description: Today reflection
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Reflection' }

  /reflections/streak:
    get:
      tags: [Reflections, Analytics]
      summary: Get reflection streak
      responses:
        '200':
          description: Streak
          content:
            application/json:
              schema:
                type: object
                properties:
                  streak_count: { type: integer }

  /reflections/prompts:
    get:
      tags: [Reflections]
      summary: Get reflection prompts
      responses:
        '200':
          description: Prompts
          content:
            application/json:
              schema:
                type: array
                items: { type: string }

  /reflections/moods:
    get:
      tags: [Reflections, Analytics]
      summary: Get mood trends
      parameters:
        - name: days
          in: query
          schema: { type: integer, default: 30 }
      responses:
        '200':
          description: Mood trends
          content:
            application/json:
              schema:
                type: object
                properties:
                  trends: { type: array, items: { type: object } }
                  average_mood: { type: string }

  /nudges:
    get:
      tags: [Nudges]
      summary: List nudges
      responses:
        '200':
          description: Nudges
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Nudge' }

  /nudges/active:
    get:
      tags: [Nudges]
      summary: Get active nudges
      responses:
        '200':
          description: Active nudges
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Nudge' }

  /nudges/history:
    get:
      tags: [Nudges]
      summary: Get nudge history
      responses:
        '200':
          description: History
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Nudge' }

  /nudges/{id}:
    get:
      tags: [Nudges]
      summary: Get nudge
      parameters: [ { $ref: '#/components/parameters/nudgeId' } ]
      responses:
        '200':
          description: Nudge
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Nudge' }

  /nudges/{id}/seen:
    post:
      tags: [Nudges]
      summary: Mark nudge seen
      parameters: [ { $ref: '#/components/parameters/nudgeId' } ]
      responses:
        '204': { description: Updated }

  /nudges/{id}/acted:
    post:
      tags: [Nudges]
      summary: Mark nudge acted
      parameters: [ { $ref: '#/components/parameters/nudgeId' } ]
      responses:
        '204': { description: Updated }

  /nudges/{id}/dismiss:
    post:
      tags: [Nudges]
      summary: Dismiss nudge
      parameters: [ { $ref: '#/components/parameters/nudgeId' } ]
      responses:
        '204': { description: Updated }

  /nudges/generate:
    post:
      tags: [Nudges]
      summary: Generate new nudges
      responses:
        '201':
          description: Nudges generated
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Nudge' }

  /gdpr/consents:
    get:
      tags: [GDPR]
      summary: Get consent records
      responses:
        '200':
          description: Consents
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/UserConsent' }
    post:
      tags: [GDPR]
      summary: Update/record consent
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateConsentRequest' }
      responses:
        '200':
          description: Updated consent
          content:
            application/json:
              schema: { $ref: '#/components/schemas/UserConsent' }

  /gdpr/export:
    post:
      tags: [GDPR]
      summary: Request data export
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                format:
                  type: string
                  enum: [json, csv]
                  default: json
      responses:
        '202':
          description: Export accepted
          content:
            application/json:
              schema: { $ref: '#/components/schemas/DataExport' }

  /gdpr/export/{id}:
    get:
      tags: [GDPR]
      summary: Get export status
      parameters: [ { $ref: '#/components/parameters/exportId' } ]
      responses:
        '200':
          description: Export status
          content:
            application/json:
              schema: { $ref: '#/components/schemas/DataExport' }

  /gdpr/export/{id}/download:
    get:
      tags: [GDPR]
      summary: Download export file (signed URL)
      parameters: [ { $ref: '#/components/parameters/exportId' } ]
      responses:
        '200':
          description: File link
          content:
            application/json:
              schema:
                type: object
                properties:
                  url: { type: string, format: uri }

  /gdpr/delete:
    post:
      tags: [GDPR]
      summary: Delete all user data (account deletion)
      responses:
        '202': { description: Deletion requested }

  /gdpr/anonymize:
    post:
      tags: [GDPR]
      summary: Anonymize user data
      responses:
        '202': { description: Anonymization requested }

  /recommendations:
    get:
      tags: [Analytics]
      summary: Get active recommendations
      responses:
        '200':
          description: Active recommendations
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: string }
                    type: { type: string }
                    title: { type: string }
                    description: { type: string }
                    priority: { type: string }
                    status: { type: string }
                    created_at: { $ref: '#/components/schemas/Timestamp' }

  /recommendations/{id}/status:
    post:
      tags: [Analytics]
      summary: Update recommendation status
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status: { type: string, enum: [pending, accepted, dismissed, completed] }
              required: [status]
      responses:
        '200':
          description: Status updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /analytics/dashboard:
    get:
      tags: [Analytics]
      summary: Get dashboard analytics
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /analytics/metrics:
    get:
      tags: [Analytics]
      summary: Get user metrics
      parameters:
        - name: period
          in: query
          schema: { type: string, enum: [day, week, month, year] }
      responses:
        '200':
          description: Metrics
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /analytics/trends:
    get:
      tags: [Analytics]
      summary: Get analytics trends
      parameters:
        - name: days
          in: query
          schema: { type: integer, default: 30 }
      responses:
        '200':
          description: Trends data
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /analytics/event:
    post:
      tags: [Analytics]
      summary: Track analytics event
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                event_type: { type: string }
                properties: { type: object, additionalProperties: true }
              required: [event_type]
      responses:
        '201':
          description: Event tracked
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /analytics/events:
    get:
      tags: [Analytics]
      summary: Get analytics events
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
        - name: event_type
          in: query
          schema: { type: string }
      responses:
        '200':
          description: Events list
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  events: { type: array, items: { type: object } }

  /analytics/daily-metrics:
    get:
      tags: [Analytics]
      summary: Get daily metrics
      parameters:
        - name: start_date
          in: query
          schema: { type: string, format: date }
        - name: end_date
          in: query
          schema: { type: string, format: date }
      responses:
        '200':
          description: Daily metrics
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  additionalProperties: true

  /analytics/insights:
    get:
      tags: [Analytics]
      summary: Get overall AI insights
      responses:
        '200':
          description: Overall insights
          content:
            application/json:
              schema:
                type: object
                properties:
                  insights: { type: array, items: { type: string } }
                  generated_at: { $ref: '#/components/schemas/Timestamp' }

  /analytics/batch-analyze:
    post:
      tags: [Analytics]
      summary: Batch analyze data
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                entity_ids: { type: array, items: { type: string } }
                analysis_type: { type: string }
      responses:
        '202':
          description: Batch analysis started
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id: { type: string }
                  status: { type: string }

  /analytics/jobs/{id}:
    get:
      tags: [Analytics]
      summary: Get analysis job status
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id: { type: string }
                  status: { type: string }
                  progress: { type: number }
                  result: { type: object, additionalProperties: true }

  /notifications/preferences:
    get:
      tags: [Users]
      summary: Get notification preferences
      responses:
        '200':
          description: Notification preferences
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
    put:
      tags: [Users]
      summary: Update notification preferences
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        '200':
          description: Preferences updated
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /notifications/test:
    post:
      tags: [Users]
      summary: Send test notification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type: { type: string }
                message: { type: string }
      responses:
        '200':
          description: Test notification sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /gdpr/audit-log:
    get:
      tags: [GDPR]
      summary: Get audit log
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: Audit log
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PaginatedAuditLogs' }

  /search:
    get:
      tags: [Search]
      summary: Global search
      parameters:
        - name: q
          in: query
          required: true
          schema: { type: string }
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: Results
          content:
            application/json:
              schema:
                type: object
                properties:
                  people:
                    type: array
                    items: { $ref: '#/components/schemas/Person' }

  /search/suggestions:
    get:
      tags: [Search]
      summary: Search suggestions
      parameters:
        - name: q
          in: query
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Suggestions
          content:
            application/json:
              schema:
                type: array
                items: { type: string }

  /users:
    get:
      tags: [Admin]
      summary: List all users (admin only)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: Users list
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  users: { type: array, items: { $ref: '#/components/schemas/User' } }

  /users/{id}:
    get:
      tags: [Admin]
      summary: Get user by ID (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema: { $ref: '#/components/schemas/User' }
    put:
      tags: [Admin]
      summary: Update user (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateUserRequest' }
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/User' }
    delete:
      tags: [Admin]
      summary: Delete user (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204':
          description: User deleted

  /users/{id}/suspend:
    post:
      tags: [Admin]
      summary: Suspend user (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: User suspended
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /users/{id}/unsuspend:
    post:
      tags: [Admin]
      summary: Unsuspend user (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: User unsuspended
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /system/stats:
    get:
      tags: [Admin, System]
      summary: Get system statistics (admin only)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: System stats
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /system/health:
    get:
      tags: [Admin, System]
      summary: Get system health (admin only)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: System health
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string }
                  checks: { type: object, additionalProperties: true }

  /system/cache/clear:
    post:
      tags: [Admin, System]
      summary: Clear system cache (admin only)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cache cleared
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /system/logs:
    get:
      tags: [Admin, System]
      summary: Get system logs (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: level
          in: query
          schema: { type: string, enum: [debug, info, warn, error] }
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: System logs
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  additionalProperties: true

  /system/config:
    get:
      tags: [Admin, System]
      summary: Get system configuration (admin only)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: System config
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
    put:
      tags: [Admin, System]
      summary: Update system configuration (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        '200':
          description: Config updated
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /health:
    get:
      tags: [System]
      summary: Health check endpoint
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: healthy }
                  service: { type: string, example: vyve-api }
                  version: { type: string, example: '1.0.0' }
                  time: { type: integer, format: int64 }

  /ws:
    get:
      tags: [System]
      summary: WebSocket endpoint for real-time updates
      security: []
      responses:
        '101':
          description: Switching Protocols to WebSocket

  /sse:
    get:
      tags: [System]
      summary: Server-Sent Events endpoint
      security:
        - bearerAuth: []
      responses:
        '200':
          description: SSE stream
          content:
            text/event-stream:
              schema:
                type: string

  /auth/signup:
    post:
      tags: [Auth]
      summary: Create new user account
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SignupRequest' }
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }
        '400':
          description: Bad request (e.g., invalid input)
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
        '409':
          description: User already exists
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }

  /people/count:
    get:
      tags: [People]
      summary: Get total count of people for the current user
      description: Returns the total number of people/relationships for the authenticated user. This includes all active and inactive relationships.
      operationId: countPeople
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                required: [count]
                properties:
                  count: 
                    type: integer
                    format: int64
                    minimum: 0
                    description: Total number of people for the current user
                    example: 42
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

  /users/me/onboarding:
    get:
      tags: [Users]
      summary: Get user's onboarding status
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OnboardingStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Users]
      summary: Mark onboarding as completed
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                completed:
                  type: boolean
                  description: Whether onboarding is completed
              required: [completed]
      responses:
        '200':
          description: Onboarding status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OnboardingStatus'
        '400':
          description: Invalid request
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
        '401':
          $ref: '#/components/responses/Unauthorized'

  /users/me/onboarding/complete:
    post:
      tags: [Users]
      summary: Mark onboarding as completed (alternative endpoint)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                completed:
                  type: boolean
                  description: Whether onboarding is completed
              required: [completed]
      responses:
        '200':
          description: Onboarding status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OnboardingStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /users/me/oauth/link/{provider}:
    post:
      tags: [Users]
      summary: Link OAuth account
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [google, linkedin, apple]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code: { type: string }
                state: { type: string }
      responses:
        '200':
          description: Account linked
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /users/me/oauth/unlink/{provider}:
    delete:
      tags: [Users]
      summary: Unlink OAuth account
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [google, linkedin, apple]
      responses:
        '204':
          description: Account unlinked

  /users/me/push-token:
    post:
      tags: [Users]
      summary: Register push notification token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token: { type: string }
                platform: { type: string, enum: [ios, android, web] }
              required: [token, platform]
      responses:
        '200':
          description: Token registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }

  /users/me/push-token/{token}:
    delete:
      tags: [Users]
      summary: Deactivate push notification token
      parameters:
        - name: token
          in: path
          required: true
          schema: { type: string }
      responses:
        '204':
          description: Token deactivated


components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    page:
      name: page
      in: query
      schema: { type: integer, minimum: 1, default: 1 }
    limit:
      name: limit
      in: query
      schema: { type: integer, minimum: 1, maximum: 100, default: 20 }
    personId:
      name: id
      in: path
      required: true
      schema: { type: string, format: uuid }
    interactionId:
      name: id
      in: path
      required: true
      schema: { type: string, format: uuid }
    reflectionId:
      name: id
      in: path
      required: true
      schema: { type: string, format: uuid }
    nudgeId:
      name: id
      in: path
      required: true
      schema: { type: string, format: uuid }
    exportId:
      name: id
      in: path
      required: true
      schema: { type: string, format: uuid }

  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema: { $ref: '#/components/schemas/Error' }
    NotFound:
      description: Not found
      content:
        application/json:
          schema: { $ref: '#/components/schemas/Error' }
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema: { $ref: '#/components/schemas/Error' }
    ServerError:
      description: Internal server error
      content:
        application/json:
          schema: { $ref: '#/components/schemas/Error' }

  schemas:
    UUID:
      type: string
      format: uuid
    Timestamp:
      type: string
      format: date-time

    Error:
      type: object
      properties:
        error: { type: string }
        message: { type: string }

    AuthResponse:
      type: object
      properties:
        access_token: { type: string }
        refresh_token: { type: string }
        token_type: { type: string, example: Bearer }
        expires_in: { type: integer }

    LoginRequest:
      type: object
      properties:
        username: { type: string }
        email: { type: string }
        password: { type: string }
      required: [password]

    RefreshRequest:
      type: object
      properties:
        refresh_token: { type: string }
      required: [refresh_token]

    User:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        username: { type: string }
        email: { type: string }
        email_verified: { type: boolean }
        avatar_url: { type: string }
        display_name: { type: string }
        bio: { type: string }
        timezone: { type: string }
        locale: { type: string }
        last_login_at: { $ref: '#/components/schemas/Timestamp' }
        created_at: { $ref: '#/components/schemas/Timestamp' }
        updated_at: { $ref: '#/components/schemas/Timestamp' }

    UpdateUserRequest:
      type: object
      properties:
        display_name: { type: string }
        bio: { type: string }
        timezone: { type: string }
        locale: { type: string }
        avatar_url: { type: string }

    CreatePersonRequest:
      type: object
      properties:
        name: { type: string }
        relationship: { type: string }
        category_id: { $ref: '#/components/schemas/UUID' }
        communication_method_id: { $ref: '#/components/schemas/UUID' }
        relationship_status_id: { $ref: '#/components/schemas/UUID' }
        intention_id: { $ref: '#/components/schemas/UUID' }
        context:
          type: array
          items: { type: string }
        notes: { type: string }
      required: [name]

    UpdatePersonRequest:
      allOf:
        - $ref: '#/components/schemas/CreatePersonRequest'

    Person:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        user_id: { $ref: '#/components/schemas/UUID' }
        name: { type: string }
        relationship: { type: string }
        category_id: { $ref: '#/components/schemas/UUID' }
        communication_method_id: { $ref: '#/components/schemas/UUID' }
        relationship_status_id: { $ref: '#/components/schemas/UUID' }
        intention_id: { $ref: '#/components/schemas/UUID' }
        context:
          type: array
          items: { type: string }
        notes: { type: string }
        health_score: { type: number, format: float }
        reminder_frequency: { type: string }
        next_reminder_at: { $ref: '#/components/schemas/Timestamp' }
        created_at: { $ref: '#/components/schemas/Timestamp' }
        updated_at: { $ref: '#/components/schemas/Timestamp' }

    Category:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        user_id: { $ref: '#/components/schemas/UUID' }
        name: { type: string }
        color: { type: string }

    CommunicationMethod:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        name: { type: string }
        icon: { type: string }

    RelationshipStatus:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        name: { type: string }
        color: { type: string }

    Intention:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        name: { type: string }
        color: { type: string }

    EnergyPattern:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        name: { type: string }
        color: { type: string }

    CreateInteractionRequest:
      type: object
      properties:
        person_id: { $ref: '#/components/schemas/UUID' }
        energy_pattern_id: { $ref: '#/components/schemas/UUID' }
        communication_method_id: { $ref: '#/components/schemas/UUID' }
        relationship_status_id: { $ref: '#/components/schemas/UUID' }
        intention_id: { $ref: '#/components/schemas/UUID' }
        interaction_at: { $ref: '#/components/schemas/Timestamp' }
        notes: { type: string }
        metadata:
          type: object
          additionalProperties: true
      required: [person_id]

    UpdateInteractionRequest:
      allOf:
        - $ref: '#/components/schemas/CreateInteractionRequest'

    Interaction:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        user_id: { $ref: '#/components/schemas/UUID' }
        person_id: { $ref: '#/components/schemas/UUID' }
        energy_pattern_id: { $ref: '#/components/schemas/UUID' }
        communication_method_id: { $ref: '#/components/schemas/UUID' }
        relationship_status_id: { $ref: '#/components/schemas/UUID' }
        intention_id: { $ref: '#/components/schemas/UUID' }
        interaction_at: { $ref: '#/components/schemas/Timestamp' }
        notes: { type: string }
        metadata:
          type: object
          additionalProperties: true
        created_at: { $ref: '#/components/schemas/Timestamp' }
        updated_at: { $ref: '#/components/schemas/Timestamp' }

    CreateReflectionRequest:
      type: object
      properties:
        mood: { type: string }
        notes: { type: string }
        completed_at: { $ref: '#/components/schemas/Timestamp' }

    UpdateReflectionRequest:
      allOf:
        - $ref: '#/components/schemas/CreateReflectionRequest'

    Reflection:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        user_id: { $ref: '#/components/schemas/UUID' }
        mood: { type: string }
        notes: { type: string }
        completed_at: { $ref: '#/components/schemas/Timestamp' }
        created_at: { $ref: '#/components/schemas/Timestamp' }
        updated_at: { $ref: '#/components/schemas/Timestamp' }

    Nudge:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        user_id: { $ref: '#/components/schemas/UUID' }
        type: { type: string }
        title: { type: string }
        message: { type: string }
        created_at: { $ref: '#/components/schemas/Timestamp' }
        seen_at: { $ref: '#/components/schemas/Timestamp' }
        acted_at: { $ref: '#/components/schemas/Timestamp' }
        dismissed_at: { $ref: '#/components/schemas/Timestamp' }

    UserConsent:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        user_id: { $ref: '#/components/schemas/UUID' }
        consent_type: { type: string }
        granted: { type: boolean }
        version: { type: string }
        ip_address: { type: string }
        user_agent: { type: string }
        granted_at: { $ref: '#/components/schemas/Timestamp' }
        revoked_at: { $ref: '#/components/schemas/Timestamp' }

    UpdateConsentRequest:
      type: object
      properties:
        consent_type: { type: string }
        granted: { type: boolean }
        version: { type: string }
      required: [consent_type, granted]

    OnboardingStatus:
      type: object
      description: Represents the onboarding status of a user
      properties:
        completed:
          type: boolean
          description: Whether the onboarding process is completed
          example: false
        current_step:
          type: integer
          description: The current step in the onboarding process (1-based index)
          minimum: 1
          example: 2
        total_steps:
          type: integer
          description: Total number of steps in the onboarding process
          minimum: 1
          example: 5
        last_updated:
          $ref: '#/components/schemas/Timestamp'
          description: When the onboarding status was last updated
      required:
        - completed
        - current_step
        - total_steps
        - last_updated

    DataExport:
      type: object
      properties:
        id: { $ref: '#/components/schemas/UUID' }
        user_id: { $ref: '#/components/schemas/UUID' }
        status: { type: string, enum: [pending, processing, completed, failed] }
        format: { type: string, enum: [json, csv] }
        file_url: { type: string, format: uri }
        file_size: { type: integer }
        requested_at: { $ref: '#/components/schemas/Timestamp' }
        completed_at: { $ref: '#/components/schemas/Timestamp' }
        expires_at: { $ref: '#/components/schemas/Timestamp' }
        error: { type: string }

    PaginatedPeople:
      type: object
      properties:
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }
        total_pages: { type: integer }
        has_next: { type: boolean }
        has_previous: { type: boolean }
        items:
          type: array
          items: { $ref: '#/components/schemas/Person' }

    PaginatedInteractions:
      allOf:
        - $ref: '#/components/schemas/PaginatedPeople'
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/Interaction' }

    PaginatedReflections:
      allOf:
        - $ref: '#/components/schemas/PaginatedPeople'
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/Reflection' }
    
    SignupRequest:
      type: object
      properties:
        username: 
          type: string
          minLength: 3
          maxLength: 30
          pattern: '^[a-zA-Z0-9_]+$'
          description: Username (alphanumeric and underscores only)
        email: 
          type: string
          format: email
          description: User's email address
        password: 
          type: string
          minLength: 8
          format: password
          description: Password (min 8 characters)
        display_name: 
          type: string
          minLength: 2
          maxLength: 50
          description: User's display name
      required: [username, email, password]

    PaginatedAuditLogs:
      allOf:
        - $ref: '#/components/schemas/PaginatedPeople'
      properties:
        items:
          type: array
          items:
            type: object
            properties:
              id: { $ref: '#/components/schemas/UUID' }
              user_id: { $ref: '#/components/schemas/UUID' }
              action: { type: string }
              entity_type: { type: string }
              entity_id: { type: string }
              changes: { type: object, additionalProperties: true }
              ip_address: { type: string }
              user_agent: { type: string }
              request_id: { type: string }
              session_id: { type: string }
              result: { type: string }
              error_message: { type: string }
              created_at: { $ref: '#/components/schemas/Timestamp' }